<!DOCTYPE html>
<html lang="en" ng-app="unityApp">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iACADEMY SMS - Unity SPA</title>

  <!-- Tailwind CSS via CDN (ok for dev; replace for production) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for icons used in templates -->
  <!-- Remove SRI to avoid integrity mismatch in some environments; jsDelivr fallback remains below -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
  <!-- Fallback Font Awesome (jsDelivr) and safety weight fix -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
  <style>
    /* Ensure solid icons render even if other CSS overrides font-weight */
    .fas { font-weight: 900 !important; }
  </style>

  <!-- Pre-bootstrap normalization: fix malformed hash paths like '#//registrar/...'
       This must run BEFORE Angular is loaded to prevent $location:badpath on initial parse. -->
  <script>
    (function () {
      try {
        var h = window.location.hash || '';
        // Normalize any leading double-slashes after the hash to a single slash
        var fixed = h.replace(/^#\/{2,}/, '#\/');
        if (fixed !== h) {
          // Use replace() to avoid polluting history
          var href = window.location.href.replace(h, fixed);
          window.location.replace(href);
        }
      } catch (e) {
        // swallow
      }
    })();
  </script>

  <!-- AngularJS 1.x and ngRoute -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-route.min.js"></script>
  <!-- SweetAlert2 for nicer confirms/alerts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Select2 for enhanced selects (requires jQuery) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- Select2 theming to match Tailwind input styles -->
  <style>
    /* Ensure Select2 fills container */
    .select2-container { width: 100% !important; }

    /* Match Tailwind input: border, radius, padding, height */
    .select2-container .select2-selection--single {
      height: 2.5rem; /* ~40px */
      border: 1px solid #d1d5db; /* gray-300 */
      border-radius: 0.25rem; /* rounded */
      padding: 0.375rem 0.75rem; /* py-1.5 px-3 */
      display: flex;
      align-items: center;
      background-color: #fff;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
      color: #111827; /* gray-900 */
      line-height: 1.25rem;
      padding-left: 0;
      margin-left: 0;
    }

    .select2-container--default .select2-selection--single .select2-selection__placeholder {
      color: #6b7280; /* gray-500 */
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 100%;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
    }

    /* Focus ring to match Tailwind focus:ring-blue-500 */
    .select2-container--default .select2-selection--single:focus,
    .select2-container--default .select2-selection--single:focus-within,
    .select2-container--default.select2-container--focus .select2-selection--single {
      outline: none;
      border-color: #3b82f6; /* blue-500 */
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    /* Dropdown styling */
    .select2-dropdown {
      border-color: #d1d5db; /* gray-300 */
      border-radius: 0.25rem;
      overflow: hidden;
    }

    .select2-search--dropdown .select2-search__field {
      border: 1px solid #d1d5db;
      border-radius: 0.25rem;
      padding: 0.375rem 0.75rem;
    }

    .select2-results__option--highlighted.select2-results__option--selectable {
      background-color: #3b82f6; /* blue-500 */
      color: #fff;
    }

    .select2-results__option--selected {
      background-color: #e5e7eb; /* gray-200 */
      color: #111827;
    }
  </style>

  <!-- Runtime base/config bootstrap -->
  <script>
    (function () {
      // Compute base root of this project when served from XAMPP or any subfolder.
      // If this file is served from /iacademy/cebu-iac-lms/frontend/unity-spa/index.html
      // then baseRoot => /iacademy/cebu-iac-lms
      var path = window.location.pathname || '/';
      var parts = path.split('/');
      // remove last 3 segments: 'frontend', 'unity-spa', and file/empty
      var trimmed = parts;
      if (trimmed.length >= 3) {
        trimmed = parts.slice(0, parts.length - 3);
      }
      var baseRoot = trimmed.join('/') || '/';
      if (baseRoot.length > 1) {
        baseRoot = baseRoot.replace(/\/+$/, '');
      }

      // var defaultApi = (baseRoot === '/' ? '' : baseRoot) + '/laravel-api/public/api/v1';
      var defaultApi = "http://127.0.0.1:8000/api/v1";

      // Base URL of the Laravel API v1. Can be overridden by setting window.API_BASE before this script.
      window.API_BASE = window.API_BASE || defaultApi;

      // Optional: redirects after successful login (if served under same host)
      window.AFTER_LOGIN_REDIRECTS = window.AFTER_LOGIN_REDIRECTS || {
        faculty: (baseRoot === '/' ? '' : baseRoot) + '/unity',
        student: (baseRoot === '/' ? '' : baseRoot) + '/portal'
      };

      // Control whether to use redirects above or show a local dashboard
      window.LOGIN_APP_CONFIG = Object.assign(
        { useRedirects: false },
        window.LOGIN_APP_CONFIG || {}
      );
    })();
  </script>

  <!-- RBAC role overrides -->
  <script>
    // Frontend-only role mapping for specific users. This augments (not replaces) any existing map.
    window.USER_ROLE_MAP = Object.assign({}, window.USER_ROLE_MAP || {}, {
      'smssuperadmin': ['admin']
    });
  </script>

  <!-- Core app files -->
  <script src="core/app.module.js"></script>
  <script src="core/filters.js"></script>
  <script src="core/constants.js"></script>
  <script src="core/roles.constants.js"></script>
  <script src="core/role.service.js"></script>
  <script src="core/link.service.js"></script>
  <script src="core/storage.service.js"></script>
  <script src="core/campus.service.js"></script>
  <script src="core/term.service.js"></script>
  <script src="core/routes.js"></script>
  <script src="core/run.js"></script>
  <script src="core/toast.service.js"></script>

  <!-- Shared components -->
  <script src="shared/components/header/header.controller.js"></script>
  <script src="shared/components/header/header.directive.js"></script>
  <!-- Campus selector (used inside sidebar) -->
  <script src="shared/components/campus-selector/campus-selector.controller.js"></script>
  <script src="shared/components/campus-selector/campus-selector.directive.js"></script>
  <!-- Term selector (used inside sidebar) -->
  <script src="shared/components/term-selector/term-selector.controller.js"></script>
  <script src="shared/components/term-selector/term-selector.directive.js"></script>
  <!-- Sidebar component -->
  <script src="shared/components/sidebar/sidebar.controller.js"></script>
  <script src="shared/components/sidebar/sidebar.directive.js"></script>
  <!-- Shared directives -->
  <script src="shared/directives/select2.directive.js"></script>

  <!-- Features -->
  <script src="features/auth/auth.service.js"></script>
  <script src="features/auth/login.controller.js"></script>

  <script src="features/dashboard/dashboard.controller.js"></script>

  <script src="features/faculty/profile.controller.js"></script>
  <script src="features/faculty/settings.controller.js"></script>
  <script src="features/faculty/classes.controller.js"></script>

  <!-- Registrar/Finance/Scholarship placeholders -->
  <script src="features/registrar/reports.service.js"></script>
  <script src="features/registrar/reports.controller.js"></script>
  <!-- Daily Enrollment (SPA) -->
  <script src="features/registrar/daily-enrollment.service.js"></script>
  <script src="features/registrar/daily-enrollment.controller.js"></script>
  <script src="features/finance/ledger.controller.js"></script>
  <script src="features/scholarship/students.controller.js"></script>
  <script src="features/students/students.controller.js"></script>
  <script src="features/students/checklist.service.js"></script>
  <script src="features/students/viewer.controller.js"></script>
  <script src="features/students/records.controller.js"></script>
  <!-- Admissions application feature -->
  <script src="features/admissions/apply.controller.js"></script>

  <!-- Campuses feature -->
  <script src="features/campuses/campuses.service.js"></script>
  <script src="features/campuses/campuses.controller.js"></script>
  <script src="features/campuses/campus-edit.controller.js"></script>

  <!-- Programs feature -->
  <script src="features/programs/programs.service.js"></script>
  <script src="features/programs/programs.controller.js"></script>

  <!-- Faculty admin feature -->
  <script src="features/faculty/faculty.service.js"></script>
  <script src="features/faculty/faculty.controller.js"></script>

  <!-- School Years feature -->
  <script src="features/school-years/school-years.service.js"></script>
  <script src="features/school-years/school-years.controller.js"></script>

  <!-- Subjects feature -->
  <script src="features/subjects/subjects.service.js"></script>
  <script src="features/subjects/subjects.controller.js"></script>

  <!-- Curricula feature -->
  <script src="features/curricula/curricula.service.js"></script>
  <script src="features/curricula/curricula.controller.js"></script>

  <!-- Classlists feature -->
  <script src="features/classlists/classlists.service.js"></script>
  <script src="features/classlists/classlists.controller.js"></script>
  <script src="features/classlists/classlist-edit.controller.js"></script>
  <script src="features/classlists/viewer.controller.js"></script>

  <!-- Classrooms feature -->
  <script src="features/classrooms/classrooms.service.js"></script>
  <script src="features/classrooms/classrooms.controller.js"></script>
  <script src="features/classrooms/classroom-edit.controller.js"></script>

  <!-- Grading Systems feature -->
  <script src="features/grading/grading.service.js"></script>
  <script src="features/grading/grading.controller.js"></script>

  <!-- Tuition Years feature (Finance) -->
  <script src="features/tuition-years/tuition-years.service.js"></script>
  <script src="features/tuition-years/tuition-years.controller.js"></script>

  <!-- Roles admin feature -->
  <script src="features/roles/roles.service.js"></script>
  <script src="features/roles/roles.controller.js"></script>

  <!-- System Logs feature -->
  <script src="features/logs/logs.service.js"></script>
  <script src="features/logs/logs.controller.js"></script>

  <!-- Unity feature -->
  <script src="features/unity/unity.service.js"></script>
  <!-- Registrar Enlistment feature -->
  <script src="features/registrar/enlistment/enlistment.controller.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Global header -->
  <app-header></app-header>

  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Route outlet -->
  <div class="main-content container mx-auto px-4 py-10">
    <div ng-view></div>
  </div>
</body>
</html>
