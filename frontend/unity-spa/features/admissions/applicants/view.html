<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-gray-800">Applicant Details</h1>
      <p class="text-sm text-gray-500" ng-if="vm.user">ID: {{ vm.user.intID }}</p>
    </div>
    <div class="flex items-center space-x-2">
      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium border"
            ng-class="{
              'bg-gray-100 text-gray-800 border-gray-200': (vm.status || 'new') === 'new',
              'bg-yellow-100 text-yellow-800 border-yellow-200': vm.status === 'reserved' || vm.status === 'interviewed',
              'bg-green-100 text-green-800 border-green-200': vm.status === 'paid' || vm.status === 'enrolled'
            }">
        {{ vm.status || 'new' }}
      </span>
      <!-- Payment statuses surfaced to header -->
      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
            ng-class="{'bg-green-100 text-green-800': vm.paid_application_fee, 'bg-gray-100 text-gray-700': !vm.paid_application_fee}">
        <span class="fas" ng-class="{'fa-check-circle mr-1': vm.paid_application_fee, 'fa-times-circle mr-1': !vm.paid_application_fee}"></span>
        Application Fee: {{ vm.paid_application_fee ? 'Paid' : 'Unpaid' }}
      </span>      
      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
            ng-class="{'bg-green-100 text-green-800': !!vm.interviewed, 'bg-gray-100 text-gray-700': !vm.interviewed}">
        <span class="fas" ng-class="{'fa-check-circle mr-1': !!vm.interviewed, 'fa-times-circle mr-1': !vm.interviewed}"></span>
        Interviewed: {{ vm.interviewed ? 'Yes' : 'No' }}
      </span>
      <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
            ng-class="{'bg-green-100 text-green-800': vm.paid_reservation_fee, 'bg-gray-100 text-gray-700': !vm.paid_reservation_fee}">
        <span class="fas" ng-class="{'fa-check-circle mr-1': vm.paid_reservation_fee, 'fa-times-circle mr-1': !vm.paid_reservation_fee}"></span>
        Reservation Fee: {{ vm.paid_reservation_fee ? 'Paid' : 'Unpaid' }}
      </span>
      <button class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
              ng-if="!vm.editing"
              ng-click="vm.startEdit()">
        Edit
      </button>
      <button class="inline-flex items-center px-3 py-2 bg-gray-100 text-gray-700 text-sm rounded-md hover:bg-gray-200"
              ng-click="vm.backToList()">
        Back
      </button>
    </div>
  </div>

  <!-- Alerts -->
  <div class="rounded-md bg-red-50 p-4 border border-red-200" ng-if="vm.error">
    <div class="flex">
      <div class="flex-shrink-0">
        <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-.75-10.75a.75.75 0 011.5 0v4.5a.75.75 0 11-1.5 0v-4.5zm.75 7a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-medium text-red-800">Error</h3>
        <div class="mt-2 text-sm text-red-700">{{ vm.error }}</div>
      </div>
    </div>
  </div>

  <!-- Skeleton/loading -->
  <div ng-if="vm.loading" class="space-y-4">
    <div class="animate-pulse h-6 bg-gray-200 rounded w-1/3"></div>
    <div class="animate-pulse h-4 bg-gray-200 rounded w-1/2"></div>
    <div class="animate-pulse h-64 bg-gray-100 rounded"></div>
  </div>

  <!-- Content -->
  <div ng-if="!vm.loading && vm.user" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Core details -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg lg:col-span-1">
      <div class="border-b border-gray-200 px-4 py-3">
        <h2 class="text-lg font-semibold text-gray-800">Core Information</h2>
      </div>
      <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-medium text-gray-500">Name</label>
          <div class="text-sm text-gray-900 font-medium">
            {{ (vm.user.strLastname || '') | uppercase }}<span ng-if="vm.user.strLastname && vm.user.strFirstname">, </span>{{ vm.user.strFirstname || '' }}
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Email</label>
          <div class="text-sm text-gray-900">{{ vm.user.strEmail || '-' }}</div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Mobile</label>
          <div class="text-sm text-gray-900">{{ vm.user.strMobileNumber || vm.user.strPhoneNumber || '-' }}</div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Campus</label>
          <div class="text-sm text-gray-900">{{ vm.user.campus || vm.user.campus_id || '-' }}</div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Student Type</label>
          <div class="text-sm text-gray-900">{{ vm.user.student_type || '-' }}</div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Created</label>
          <div class="text-sm text-gray-900">
            <span ng-if="vm.created_at">{{ vm.created_at | date:'medium' }}</span>
            <span ng-if="!vm.created_at">{{ vm.user.dteCreated || '-' }}</span>
          </div>
        </div>
        <div ng-if="vm.updated_at">
          <label class="block text-xs font-medium text-gray-500">Last Updated</label>
          <div class="text-sm text-gray-900">{{ vm.updated_at | date:'medium' }}</div>
        </div>
      </div>
    </div>
    <!-- Interview -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg lg:col-span-1">
      <div class="border-b border-gray-200 px-4 py-3 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-800">Interview</h2>
        <div class="flex items-center space-x-2">
          <span class="text-xs text-gray-500" ng-if="vm.interviewLoading">Loading...</span>
          <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium border"
                ng-if="!vm.interviewLoading && !vm.interview">
            Not Scheduled
          </span>
          <!-- Scheduled -->
          <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium border bg-yellow-50 text-yellow-800 border-yellow-200"
                ng-if="!vm.interviewLoading && vm.interview && !vm.interview.completed_at">
            Scheduled
          </span>
          <!-- Completed -->
          <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium border"
                ng-if="!vm.interviewLoading && vm.interview && vm.interview.completed_at"
                ng-class="{
                  'bg-green-100 text-green-800 border-green-200': (vm.interview.assessment || '').toLowerCase() === 'passed',
                  'bg-red-100 text-red-800 border-red-200': (vm.interview.assessment || '').toLowerCase() === 'failed',
                  'bg-gray-100 text-gray-800 border-gray-200': (vm.interview.assessment || '').toLowerCase() !== 'passed' && (vm.interview.assessment || '').toLowerCase() !== 'failed'
                }">
            Completed â€” {{ vm.interview.assessment || 'N/A' }}
          </span>
        </div>
      </div>

      <div class="p-4 space-y-3">
        <!-- Error -->
        <div class="rounded-md bg-red-50 p-3 border border-red-200" ng-if="vm.interviewError">
          <div class="text-sm text-red-700">{{ vm.interviewError }}</div>
        </div>

        <!-- Loading -->
        <div ng-if="vm.interviewLoading">
          <div class="animate-pulse h-5 bg-gray-200 rounded w-1/5 mb-2"></div>
          <div class="animate-pulse h-10 bg-gray-100 rounded"></div>
        </div>

        <!-- No interview scheduled -->
        <div ng-if="!vm.interviewLoading && !vm.interview">
          <div class="text-sm text-gray-500" ng-if="!vm.canManageInterview">
            No interview scheduled.
          </div>

          <div ng-if="vm.canManageInterview" class="space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-500">Scheduled At</label>
                <input type="datetime-local"
                      class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                      ng-model="vm.schedule.scheduled_at"
                      ng-disabled="vm.scheduling" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-500">Remarks</label>
                <input type="text"
                      class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                      placeholder="Optional notes"
                      ng-model="vm.schedule.remarks"
                      ng-disabled="vm.scheduling" />
              </div>
            </div>
            <div class="pt-1">
              <button class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50"
                      ng-click="vm.scheduleInterview()"
                      ng-disabled="vm.scheduling || !vm.schedule.scheduled_at">
                <span ng-if="!vm.scheduling">Schedule Interview</span>
                <span ng-if="vm.scheduling">Scheduling...</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Existing interview -->
        <div ng-if="!vm.interviewLoading && vm.interview" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-medium text-gray-500">Scheduled At</label>
              <div class="text-sm text-gray-900">{{ vm.interview.scheduled_at || '-' }}</div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-500">Interviewer</label>
              <div class="text-sm text-gray-900">{{ vm.interview.interviewer_name || '-' }}</div>
            </div>
            <div class="md:col-span-2">
              <label class="block text-xs font-medium text-gray-500">Remarks</label>
              <div class="text-sm text-gray-900">{{ vm.interview.remarks || '-' }}</div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-500">Assessment</label>
              <div class="text-sm text-gray-900">{{ vm.interview.assessment || '-' }}</div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-500">Reason for Failing</label>
              <div class="text-sm text-gray-900">{{ vm.interview.reason_for_failing || '-' }}</div>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-500">Completed At</label>
              <div class="text-sm text-gray-900">{{ vm.interview.completed_at || '-' }}</div>
            </div>
          </div>

          <!-- Result actions -->
          <div ng-if="vm.canManageInterview && !vm.interview.completed_at" class="space-y-3 border-t border-gray-200 pt-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs font-medium text-gray-500">Remarks</label>
                <input type="text"
                      class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                      placeholder="Optional notes"
                      ng-model="vm.result.remarks"
                      ng-disabled="vm.resultSaving" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-500">Reason for Failing</label>
                <input type="text"
                      class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                      placeholder="Required if marking as Failed"
                      ng-model="vm.result.reason_for_failing"
                      ng-disabled="vm.resultSaving" />
              </div>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <button class="inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 disabled:opacity-50"
                      ng-click="vm.submitResult('Passed')"
                      ng-disabled="vm.resultSaving">
                <span ng-if="!vm.resultSaving">Mark as Passed</span>
                <span ng-if="vm.resultSaving">Submitting...</span>
              </button>
              <button class="inline-flex items-center px-3 py-2 bg-red-600 text-white text-sm rounded-md hover:bg-red-700 disabled:opacity-50"
                      ng-click="vm.submitResult('Failed')"
                      ng-disabled="vm.resultSaving">
                <span ng-if="!vm.resultSaving">Mark as Failed</span>
                <span ng-if="vm.resultSaving">Submitting...</span>
              </button>
              <button class="inline-flex items-center px-3 py-2 bg-gray-100 text-gray-700 text-sm rounded-md hover:bg-gray-200 disabled:opacity-50"
                      ng-click="vm.submitResult('No Show')"
                      ng-disabled="vm.resultSaving">
                <span ng-if="!vm.resultSaving">Mark as No Show</span>
                <span ng-if="vm.resultSaving">Submitting...</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Applicant Journey -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg lg:col-span-1">
      <div class="border-b border-gray-200 px-4 py-3 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-800">Applicant Journey</h2>
        <div class="flex items-center space-x-2">
          <button class="inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-700 text-xs rounded-md hover:bg-gray-200"
                  ng-click="vm.loadJourney()" ng-disabled="vm.journeyLoading || !vm.applicant_data_id">
            <span ng-if="!vm.journeyLoading">Reload</span>
            <span ng-if="vm.journeyLoading">Loading...</span>
          </button>
        </div>
      </div>

      <div class="p-4 space-y-3">
        <!-- Error -->
        <div class="rounded-md bg-red-50 p-3 border border-red-200" ng-if="vm.journeyError">
          <div class="text-sm text-red-700">{{ vm.journeyError }}</div>
        </div>

        <!-- Loading -->
        <div ng-if="vm.journeyLoading">
          <div class="animate-pulse h-5 bg-gray-200 rounded w-1/4 mb-2"></div>
          <div class="animate-pulse h-16 bg-gray-100 rounded"></div>
        </div>

        <!-- Empty -->
        <div class="text-sm text-gray-500" ng-if="!vm.journeyLoading && !vm.journeyError && (!vm.journey || vm.journey.length === 0)">
          No journey logs found.
        </div>

        <!-- Timeline -->
        <div ng-if="!vm.journeyLoading && !vm.journeyError && vm.journey && vm.journey.length">
          <div class="relative">
            <!-- Left vertical line -->
            <div class="absolute left-4 md:left-6 top-0 bottom-0 w-1 bg-indigo-300 rounded"></div>
            <div class="pl-8 md:pl-12">
              <div class="relative mb-6" ng-repeat="j in vm.journey track by j.id">
                <!-- Dot -->
                <div class="absolute -left-4 md:-left-6 top-6 w-4 h-4 bg-indigo-600 rounded-full border-2 border-white shadow"></div>
                <!-- Card -->
                <div class="relative bg-white border border-gray-200 rounded-lg shadow-md">
                  <!-- Notch (left-pointing caret) -->
                  <!-- Border layer -->
                  <div class="absolute top-6 left-0 -ml-2 w-0 h-0 border-y-[8px] border-y-transparent border-r-[8px] border-r-gray-200"></div>
                  <!-- Fill layer -->
                  <div class="absolute top-6 left-0 -ml-[7px] w-0 h-0 border-y-[7px] border-y-transparent border-r-[7px] border-r-white"></div>
                  <div class="p-4">
                    <div class="text-sm md:text-base text-gray-700 font-medium">{{ j.log_date | formatSqlDateTime:'MMMM d, y h:mm a' }}</div>
                    <div class="mt-1 text-sm text-gray-900 whitespace-pre-wrap break-words">{{ j.remarks || '-' }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Initial Requirements -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg lg:col-span-1">
      <div class="border-b border-gray-200 px-4 py-3 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-800">Initial Requirements</h2>
        <div class="flex items-center space-x-2" ng-if="vm.hash">
          <button class="inline-flex items-center px-3 py-1.5 bg-gray-100 text-gray-700 text-xs rounded-md hover:bg-gray-200"
                  ng-click="vm.loadInitialRequirements()" ng-disabled="vm.irLoading">
            <span ng-if="!vm.irLoading">Reload</span>
            <span ng-if="vm.irLoading">Loading...</span>
          </button>
        </div>
      </div>

      <div class="p-4 space-y-3">
        <!-- No hash / not available -->
        <div class="text-sm text-gray-500" ng-if="!vm.hash">
          No initial requirements link available for this applicant.
        </div>

        <!-- Loading -->
        <div ng-if="vm.irLoading">
          <div class="animate-pulse h-5 bg-gray-200 rounded w-1/4 mb-2"></div>
          <div class="animate-pulse h-10 bg-gray-100 rounded"></div>
        </div>

        <!-- Error -->
        <div class="rounded-md bg-red-50 p-3 border border-red-200" ng-if="vm.irError">
          <div class="text-sm text-red-700">{{ vm.irError }}</div>
        </div>

        <!-- Empty -->
        <div class="text-sm text-gray-500" ng-if="vm.hash && !vm.irLoading && !vm.irError && (!vm.initial_requirements || vm.initial_requirements.length === 0)">
          No initial requirements found.
        </div>

        <!-- List -->
        <div ng-if="vm.hash && !vm.irLoading && !vm.irError && vm.initial_requirements && vm.initial_requirements.length">
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 text-sm">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-2 text-left font-medium text-gray-700">Requirement</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700">Description</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700">Type</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700">Status</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700">File</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100 bg-white">
                <tr ng-repeat="req in vm.initial_requirements">
                  <td class="px-4 py-2 text-gray-900 font-medium">{{ req.name }}</td>
                  <td class="px-4 py-2 text-gray-700">
                    <span ng-if="req.description && req.description.length">{{ req.description }}</span>
                    <span ng-if="!req.description || !req.description.length" class="text-gray-400">-</span>
                  </td>
                  <td class="px-4 py-2 text-gray-700">
                    <span class="uppercase tracking-wide text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-700 border border-gray-200">{{ req.type || '-' }}</span>
                  </td>
                  <td class="px-4 py-2">
                    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
                          ng-class="{'bg-green-100 text-green-800': !!req.submitted_status, 'bg-gray-100 text-gray-700': !req.submitted_status}">
                      <span class="fas" ng-class="{'fa-check-circle mr-1': !!req.submitted_status, 'fa-times-circle mr-1': !req.submitted_status}"></span>
                      {{ req.submitted_status ? 'Submitted' : 'Not Submitted' }}
                    </span>
                  </td>
                  <td class="px-4 py-2">
                    <a ng-if="req.file_link" class="text-blue-600 hover:underline" href="{{ req.file_link }}" target="_blank" rel="noopener">
                      View
                    </a>
                    <span class="text-gray-400" ng-if="!req.file_link">-</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Edit Application Data -->
    <div ng-if="vm.editing" class="bg-white shadow-sm border border-gray-200 rounded-lg lg:col-span-2">
      <div class="border-b border-gray-200 px-4 py-3">
        <h2 class="text-lg font-semibold text-gray-800">Edit Application Data</h2>
      </div>
      <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-medium text-gray-500">First Name</label>
          <input type="text" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                 ng-model="vm.form.first_name" ng-disabled="vm.saving" />
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Middle Name</label>
          <input type="text" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                 ng-model="vm.form.middle_name" ng-disabled="vm.saving" />
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Last Name</label>
          <input type="text" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                 ng-model="vm.form.last_name" ng-disabled="vm.saving" />
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Email</label>
          <input type="email" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                 ng-model="vm.form.email" ng-disabled="vm.saving" />
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Mobile Number</label>
          <input type="text" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                 ng-model="vm.form.mobile_number" ng-disabled="vm.saving" />
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Date of Birth</label>
          <input type="date" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"
                 ng-model="vm.form.date_of_birth" ng-disabled="vm.saving" />
        </div>
      </div>
      <div class="px-4 py-3 border-t border-gray-200 flex items-center space-x-2">
        <button class="inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 disabled:opacity-50"
                ng-disabled="vm.saving"
                ng-click="vm.save()">
          <span ng-if="!vm.saving">Save</span>
          <span ng-if="vm.saving">Saving...</span>
        </button>
        <button class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm rounded-md hover:bg-gray-200 disabled:opacity-50"
                ng-disabled="vm.saving"
                ng-click="vm.cancelEdit()">
          Cancel
        </button>
      </div>
    </div>

    <!-- Known fields from applicant_data -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg lg:col-span-2">
      <div class="border-b border-gray-200 px-4 py-3">
        <h2 class="text-lg font-semibold text-gray-800">Application Data</h2>
      </div>

      <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-medium text-gray-500">Applicant Type</label>
          <div class="text-sm text-gray-900">{{ vm.applicant_type_name || (vm.applicant_data && vm.applicant_data.applicant_type) || '-' }}</div>
        </div>       

        <!-- Waive Application Fee -->
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-gray-500">Waive Application Fee</label>
          <div class="mt-1">
            <!-- Admissions/Admin can edit -->
            <div ng-if="vm.canEditWaiver" class="flex flex-col space-y-2">
              <label class="inline-flex items-center space-x-2">
                <input type="checkbox"
                       class="h-4 w-4"
                       ng-model="vm.waiver.waive_application_fee"
                       ng-disabled="vm.savingWaiver" />
                <span class="text-sm text-gray-700">Waive application fee for this applicant</span>
              </label>

              <div class="flex items-center space-x-2" ng-if="vm.waiver.waive_application_fee">
                <input type="text"
                       class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm"
                       placeholder="Reason (optional)"
                       ng-model="vm.waiver.waive_reason"
                       ng-disabled="vm.savingWaiver" />
              </div>
              <div class="mt-2">
                <button class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:opacity-50"
                        ng-click="vm.saveWaiver()"
                        ng-disabled="vm.savingWaiver">
                  <span ng-if="!vm.savingWaiver">Save</span>
                  <span ng-if="vm.savingWaiver">Saving...</span>
                </button>
              </div>

              <div class="text-xs text-gray-500" ng-if="vm.waived_at">
                Waived at: {{ vm.waived_at | date:'medium' }}
              </div>
            </div>

            <!-- Read-only for others -->
            <div ng-if="!vm.canEditWaiver" class="text-sm">
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium"
                    ng-class="{'bg-green-100 text-green-800': vm.waive_application_fee, 'bg-gray-100 text-gray-700': !vm.waive_application_fee}">
                <span class="fas" ng-class="{'fa-check-circle mr-1': vm.waive_application_fee, 'fa-times-circle mr-1': !vm.waive_application_fee}"></span>
                {{ vm.waive_application_fee ? 'Waived' : 'Not Waived' }}
              </span>
              <div class="text-xs text-gray-500 mt-1" ng-if="vm.waive_reason">
                Reason: {{ vm.waive_reason }}
              </div>
              <div class="text-xs text-gray-500" ng-if="vm.waived_at">
                Waived at: {{ vm.waived_at | date:'medium' }}
              </div>
            </div>
          </div>
        </div>

        <div>
          <label class="block text-xs font-medium text-gray-500">Program</label>
          <div class="text-sm text-gray-900">{{ vm.program_name || (vm.applicant_data && (vm.applicant_data.program || vm.applicant_data.type)) || '-' }}</div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Gender</label>
          <div class="text-sm text-gray-900">{{ (vm.applicant_data && vm.applicant_data.gender) || vm.user.enumGender || '-' }}</div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-500">Date of Birth</label>
          <div class="text-sm text-gray-900">
            <span ng-if="vm.applicant_data && vm.applicant_data.date_of_birth">{{ vm.applicant_data.date_of_birth | date:'mediumDate' }}</span>
            <span ng-if="!(vm.applicant_data && vm.applicant_data.date_of_birth)">{{ vm.user.dteBirthDate || '-' }}</span>
          </div>
        </div>
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-gray-500">Address</label>
          <div class="text-sm text-gray-900">
            <span ng-if="vm.user.strAddress">{{ vm.user.strAddress }}</span>
            <span ng-if="!vm.user.strAddress">
              {{ vm.applicant_data && (vm.applicant_data.address || vm.applicant_data.city || vm.applicant_data.state || vm.applicant_data.province || vm.applicant_data.country) ? '' : '-' }}
              <span ng-if="vm.applicant_data && vm.applicant_data.address">{{ vm.applicant_data.address }}</span>
              <span ng-if="vm.applicant_data && vm.applicant_data.city">, {{ vm.applicant_data.city }}</span>
              <span ng-if="vm.applicant_data && (vm.applicant_data.state || vm.applicant_data.province)">, {{ vm.applicant_data.state || vm.applicant_data.province }}</span>
              <span ng-if="vm.applicant_data && vm.applicant_data.country">, {{ vm.applicant_data.country }}</span>
            </span>
          </div>
        </div>
      </div>

      <!-- Organized Application Data -->
      <div class="px-4 pb-2" ng-if="vm.sections && vm.sections.length">
        <div class="space-y-4">
          <div class="border border-gray-200 rounded-lg" ng-repeat="section in vm.sections">
            <div class="px-4 py-2 border-b border-gray-200 bg-gray-50">
              <h3 class="text-sm font-semibold text-gray-800">{{ section.title }}</h3>
            </div>
            <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div ng-repeat="item in section.items">
                <label class="block text-xs font-medium text-gray-500">{{ item.label }}</label>
                <div class="text-sm text-gray-900 whitespace-pre-wrap break-words" ng-bind="item.value"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Raw JSON pretty print -->
      <div class="px-4 pb-4">
        <details class="rounded border border-gray-200">
          <summary class="cursor-pointer select-none px-4 py-2 bg-gray-50 text-sm font-medium text-gray-700">
            Raw applicant_data JSON
          </summary>
          <pre class="overflow-auto text-xs bg-gray-900 text-green-200 p-4"><code>{{ vm.applicant_data | json }}</code></pre>
        </details>
      </div>
    </div>
  </div>
  

</div>
