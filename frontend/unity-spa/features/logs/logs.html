<div class="p-4 space-y-4">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-semibold text-gray-900">System Logs</h1>
    <div class="text-sm text-gray-500" ng-if="vm.meta.total >= 0">
      {{ vm.meta.total | number }} total
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-md border border-gray-200 p-4">
    <form class="grid grid-cols-1 md:grid-cols-3 gap-3" ng-submit="vm.search()">
      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Search</label>
        <input type="text" class="w-full border rounded px-2 py-1" placeholder="q (entity/action/path/method/agent)"
               ng-model="vm.filters.q">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Entity</label>
        <input type="text" class="w-full border rounded px-2 py-1" placeholder="e.g. Campus" ng-model="vm.filters.entity">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Action</label>
        <input type="text" class="w-full border rounded px-2 py-1" placeholder="create/update/delete" ng-model="vm.filters.action">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">User ID</label>
        <input type="number" class="w-full border rounded px-2 py-1" ng-model="vm.filters.user_id">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Entity ID</label>
        <input type="number" class="w-full border rounded px-2 py-1" ng-model="vm.filters.entity_id">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">HTTP Method</label>
        <input type="text" class="w-full border rounded px-2 py-1" placeholder="GET/POST/..." ng-model="vm.filters.method">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Path</label>
        <input type="text" class="w-full border rounded px-2 py-1" placeholder="/api/..." ng-model="vm.filters.path">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Date From</label>
        <input type="date" class="w-full border rounded px-2 py-1" ng-model="vm.filters.date_from">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Date To</label>
        <input type="date" class="w-full border rounded px-2 py-1" ng-model="vm.filters.date_to">
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Per Page</label>
        <input type="number" min="1" max="100" class="w-full border rounded px-2 py-1" ng-model="vm.filters.per_page">
      </div>

      <div class="md:col-span-2 flex items-end gap-2">
        <button type="submit" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" ng-disabled="vm.loading">
          Search
        </button>
        <button type="button" class="px-3 py-2 bg-gray-100 text-gray-800 rounded hover:bg-gray-200" ng-click="vm.reset()" ng-disabled="vm.loading">
          Reset
        </button>
        <button type="button" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700" ng-click="vm.export()" ng-disabled="vm.loading">
          Export XLSX
        </button>
        <div class="text-sm text-gray-500" ng-if="vm.loading">Loading...</div>
        <div class="text-sm text-red-600" ng-if="vm.error">{{ vm.error }}</div>
      </div>
    </form>
  </div>

  <!-- Results -->
  <div class="bg-white rounded-md border border-gray-200 overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50 text-gray-700">
        <tr>
          <th class="text-left px-3 py-2 border-b">Timestamp</th>
          <th class="text-left px-3 py-2 border-b">User ID</th>
          <th class="text-left px-3 py-2 border-b">Action</th>
          <th class="text-left px-3 py-2 border-b">Entity</th>
          <th class="text-left px-3 py-2 border-b">Entity ID</th>
          <th class="text-left px-3 py-2 border-b">Method</th>
          <th class="text-left px-3 py-2 border-b">Path</th>
          <th class="text-left px-3 py-2 border-b">IP</th>
          <th class="text-left px-3 py-2 border-b">Agent</th>
          <th class="text-left px-3 py-2 border-b">Details</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="row in vm.items track by row.id" class="hover:bg-gray-50">
          <td class="px-3 py-2 border-b whitespace-nowrap">{{ row.created_at | date:'yyyy-MM-dd HH:mm:ss' }}</td>
          <td class="px-3 py-2 border-b">{{ row.user_id || '-' }}</td>
          <td class="px-3 py-2 border-b">
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                  ng-class="{
                    'bg-green-100 text-green-800': row.action === 'create',
                    'bg-yellow-100 text-yellow-800': row.action === 'update',
                    'bg-red-100 text-red-800': row.action === 'delete'
                  }">{{ row.action }}</span>
          </td>
          <td class="px-3 py-2 border-b">{{ row.entity }}</td>
          <td class="px-3 py-2 border-b">{{ row.entity_id || '-' }}</td>
          <td class="px-3 py-2 border-b">{{ row.method || '-' }}</td>
          <td class="px-3 py-2 border-b" title="{{ row.path }}">{{ vm.truncate(row.path, 40) }}</td>
          <td class="px-3 py-2 border-b">{{ row.ip_address || '-' }}</td>
          <td class="px-3 py-2 border-b" title="{{ row.user_agent }}">{{ vm.truncate(row.user_agent, 40) }}</td>
          <td class="px-3 py-2 border-b">
            <button class="text-blue-600 hover:underline" ng-click="vm.toggleExpand(row.id)">
              {{ vm.expanded[row.id] ? 'Hide' : 'View' }}
            </button>
          </td>
        </tr>
        <tr ng-if="vm.items.length === 0 && !vm.loading">
          <td colspan="10" class="px-3 py-6 text-center text-gray-500">
            No logs found
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Expanded details -->
    <div ng-repeat="row in vm.items track by ('e' + row.id)" ng-if="vm.expanded[row.id]" class="border-t px-3 py-3 bg-gray-50">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <div class="text-xs font-semibold text-gray-700 mb-1">Old Values</div>
          <pre class="text-xs bg-white border rounded p-2 overflow-auto" style="max-height: 240px">{{ vm.pretty(row.old_values) }}</pre>
        </div>
        <div>
          <div class="text-xs font-semibold text-gray-700 mb-1">New Values</div>
          <pre class="text-xs bg-white border rounded p-2 overflow-auto" style="max-height: 240px">{{ vm.pretty(row.new_values) }}</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="flex items-center justify-between">
    <div class="text-xs text-gray-600">
      Page {{ vm.meta.current_page || vm.page }} of {{ vm.meta.last_page || 1 }}
    </div>
    <div class="space-x-2">
      <button class="px-3 py-1 border rounded disabled:opacity-50"
              ng-disabled="vm.page <= 1 || vm.loading"
              ng-click="vm.go(vm.page - 1)">
        Prev
      </button>
      <button class="px-3 py-1 border rounded disabled:opacity-50"
              ng-disabled="vm.page >= (vm.meta.last_page || 1) || vm.loading"
              ng-click="vm.go(vm.page + 1)">
        Next
      </button>
    </div>
  </div>
</div>
