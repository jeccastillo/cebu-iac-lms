<div class="max-w-7xl mx-auto">
  <div class="mb-6">
    <h1 class="text-2xl font-semibold text-gray-800">Sections &amp; Slots Monitor</h1>
    <p class="text-sm text-gray-500 mt-1">
      Capacity vs utilization per section. Remaining slots = capacity - enrolled. Enlisted is displayed separately.
    </p>
  </div>

  <!-- Auth/role hint (route is gated to registrar/admin; global guard also enforces login) -->
  <div class="rounded-md bg-blue-50 border border-blue-200 p-4 mb-6">
    <div class="flex">
      <div class="shrink-0 text-blue-500">
        <i class="fas fa-info-circle"></i>
      </div>
      <div class="ml-3 text-sm text-blue-900">
        <p>
          This page requires a logged-in session with <strong>registrar</strong> or <strong>admin</strong> role.
          If you are redirected to the login page, please sign in with appropriate credentials.
        </p>
      </div>
    </div>
  </div>

  <!-- Toolbar (uses globally selected term; no local term selector) -->
  <div class="flex justify-end mb-6">
    <button class="inline-flex items-center px-3 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 text-sm"
            ng-click="vm.reload(true)">
      <i class="fas fa-sync-alt mr-2"></i>
      Refresh
    </button>
  </div>

  <!-- Data panel -->
  <div class="bg-white rounded-md shadow border border-gray-200">
    <div class="p-4 border-b border-gray-200">
      <h2 class="text-sm font-medium text-gray-700">Sections</h2>
    </div>

    <!-- Placeholder while backend wiring is pending -->
    <div class="p-6">      
      <!-- Search toolbar -->
      <div class="mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1">Section Code</label>
          <input type="text"
                 class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300"
                 ng-model="vm.search.section"
                 placeholder="e.g. BSCS-3A"
                 ng-keypress="$event.which === 13 &amp;&amp; vm.applySearch()">
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1">Subject</label>
          <input type="text"
                 class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300"
                 ng-model="vm.search.subject"
                 placeholder="Code or description"
                 ng-keypress="$event.which === 13 &amp;&amp; vm.applySearch()">
        </div>
        <div class="flex items-end gap-2">
          <button class="px-3 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 text-sm"
                  ng-click="vm.applySearch()">
            Search
          </button>
          <button class="px-3 py-2 rounded-md border border-gray-300 hover:bg-gray-50 text-sm"
                  ng-click="vm.clearSearch()">
            Clear
          </button>
        </div>
      </div>

      <!-- Optional empty table structure for future data binding -->
      <div class="mt-6 overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left font-semibold text-gray-700">Section Code</th>
              <th class="px-4 py-2 text-left font-semibold text-gray-700">Subject</th>
              <th class="px-4 py-2 text-left font-semibold text-gray-700">Faculty</th>
              <th class="px-4 py-2 text-right font-semibold text-gray-700">Capacity</th>
              <th class="px-4 py-2 text-right font-semibold text-gray-700">Enlisted</th>
              <th class="px-4 py-2 text-right font-semibold text-gray-700">Enrolled</th>
              <th class="px-4 py-2 text-right font-semibold text-gray-700">Remaining</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr ng-if="!vm.viewRows.length">
              <td colspan="7" class="px-4 py-6 text-center text-gray-500">
                No data yet. Select a term and click Refresh once the endpoint is wired.
              </td>
            </tr>
            <tr ng-repeat="r in vm.viewRows">
              <td class="px-4 py-2 text-gray-800">{{ r.section_code || '-' }}</td>
              <td class="px-4 py-2 text-gray-800">
                <a class="font-medium text-blue-600 hover:text-blue-800 hover:underline"
                   ng-href="#/classlists/{{ r.classlist_id }}/viewer">
                  {{ r.subject_code }}
                </a>
                <div class="text-xs text-gray-500">{{ r.subject_description }}</div>
              </td>
              <td class="px-4 py-2 text-gray-800">{{ r.faculty_name || '-' }}</td>
              <td class="px-4 py-2 text-right text-gray-800">{{ r.slots || 0 }}</td>
              <td class="px-4 py-2 text-right text-gray-800">{{ r.enlisted_count }}</td>
              <td class="px-4 py-2 text-right text-gray-800">{{ r.enrolled_count }}</td>
              <td class="px-4 py-2 text-right font-semibold"
                  ng-class="(r.remaining_slots || 0) > 0 ? 'text-green-600' : 'text-red-600'">
                {{ r.remaining_slots || 0 }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination placeholder -->
      <div class="mt-4 flex items-center justify-between text-sm text-gray-600">
        <div>
          Page {{ vm.meta.page }} â€¢ Showing {{ vm.viewRows.length }} of {{ vm.meta.total }}
        </div>
        <div class="space-x-2">
          <button class="px-3 py-1 rounded border border-gray-300 hover:bg-gray-50"
                  ng-disabled="vm.meta.page <= 1"
                  ng-click="vm.meta.page = vm.meta.page - 1; vm.reload(true);">
            Prev
          </button>
          <button class="px-3 py-1 rounded border border-gray-300 hover:bg-gray-50"
                  ng-disabled="(vm.meta.page * vm.meta.per_page) >= vm.meta.total"
                  ng-click="vm.meta.page = vm.meta.page + 1; vm.reload(true);">
            Next
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
