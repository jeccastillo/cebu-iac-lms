<div class="p-6">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-semibold text-gray-800">{{ vm.title }}</h1>
    <div class="space-x-2">
      <button class="px-4 py-2 bg-gray-200 text-gray-900 rounded hover:bg-gray-300" ng-click="vm.cancel()">Cancel</button>
      <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" ng-click="vm.save()" ng-disabled="vm.loading">
        {{ vm.isEdit ? 'Save Changes' : 'Create Subject' }}
      </button>
    </div>
  </div>

  <div ng-if="vm.error" class="mb-4 p-3 border border-red-300 bg-red-50 text-red-700 rounded">
    {{ vm.error }}
  </div>
  <div ng-if="vm.success" class="mb-4 p-3 border border-green-300 bg-green-50 text-green-700 rounded">
    {{ vm.success }}
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Left column: Core fields -->
    <div class="bg-white border rounded p-4">
      <h2 class="text-lg font-medium text-gray-800 mb-3">Core Information</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Subject Code <span class="text-red-600">*</span></label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strCode" maxlength="20" placeholder="e.g. CS101">
          <p class="text-xs text-gray-500 mt-1">Max 20 characters. Will be trimmed server-side.</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strDepartment" placeholder="e.g. CCS">
        </div>

        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Description <span class="text-red-600">*</span></label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strDescription" maxlength="255" placeholder="Subject title/description">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Units</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strUnits" placeholder="e.g. 3">
          <p class="text-xs text-gray-500 mt-1">Stored as string in legacy schema.</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tuition Units</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strTuitionUnits" placeholder="Defaults to Units if empty">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Lab Classification</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strLabClassification" placeholder="e.g. none, with-lab">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Lab Hours</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intLab" min="0">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Lecture Hours</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intLectHours" min="0">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Program ID</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intProgramID" min="0" placeholder="0">
        </div>
      </div>
    </div>

    <!-- Right column: Additional flags -->
    <div class="bg-white border rounded p-4">
      <h2 class="text-lg font-medium text-gray-800 mb-3">Additional Flags</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="inline-flex items-center space-x-2">
          <input type="checkbox" ng-model="vm.model.isNSTP" ng-true-value="1" ng-false-value="0">
          <span class="text-sm text-gray-700">NSTP</span>
        </label>

        <label class="inline-flex items-center space-x-2">
          <input type="checkbox" ng-model="vm.model.isThesisSubject" ng-true-value="1" ng-false-value="0">
          <span class="text-sm text-gray-700">Thesis</span>
        </label>

        <label class="inline-flex items-center space-x-2">
          <input type="checkbox" ng-model="vm.model.isInternshipSubject" ng-true-value="1" ng-false-value="0">
          <span class="text-sm text-gray-700">Internship</span>
        </label>

        <label class="inline-flex items-center space-x-2">
          <input type="checkbox" ng-model="vm.model.include_gwa" ng-true-value="1" ng-false-value="0">
          <span class="text-sm text-gray-700">Include in GWA</span>
        </label>

        <label class="inline-flex items-center space-x-2">
          <input type="checkbox" ng-model="vm.model.isElective" ng-true-value="1" ng-false-value="0">
          <span class="text-sm text-gray-700">Elective</span>
        </label>

        <label class="inline-flex items-center space-x-2">
          <input type="checkbox" ng-model="vm.model.isSelectableElective" ng-true-value="1" ng-false-value="0">
          <span class="text-sm text-gray-700">Selectable Elective</span>
        </label>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Grading System (Final)</label>
          <select class="w-full border rounded px-3 py-2"
                  ng-model="vm.model.grading_system_id"
                  ng-options="g.id as g.name for g in vm.gradingSystems">
            <option value="">-- Select Grading System --</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Grading System (Midterm)</label>
          <select class="w-full border rounded px-3 py-2"
                  ng-model="vm.model.grading_system_id_midterm"
                  ng-options="g.id as g.name for g in vm.gradingSystems">
            <option value="">-- Select Grading System --</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Strand</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.model.strand" placeholder="optional">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Bridging</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intBridging" min="0" placeholder="0">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Major</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intMajor" min="0" placeholder="0">
        </div>
      </div>

      <!-- <hr class="my-4">

      <h3 class="text-md font-medium text-gray-800 mb-2">Legacy Equivalent/Prereq Slots</h3>
      <p class="text-xs text-gray-500 mb-3">These are legacy single-value slots; full prerequisites are managed below.</p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Prerequisite ID (legacy)</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intPrerequisiteID" min="0" placeholder="0">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Equivalent ID 1</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intEquivalentID1" min="0" placeholder="0">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Equivalent ID 2</label>
          <input type="number" class="w-full border rounded px-3 py-2" ng-model="vm.model.intEquivalentID2" min="0" placeholder="0">
        </div>
      </div> -->
    </div>
  </div>

  <!-- Prerequisites Management -->

  <!-- Corequisites Management -->
  <div class="mt-6 bg-white border rounded p-4">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-medium text-gray-800">Corequisites</h2>
      <span class="text-xs text-gray-500" ng-if="!vm.isEdit">Save the subject first to manage corequisites.</span>
    </div>

    <div ng-if="vm.isEdit">
      <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-4">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Corequisite Subject</label>
          <select class="w-full border rounded px-3 py-2" 
                  ng-model="vm.addCoreqId" 
                  select2
                  select2-watch="vm.availableSubjects"
                  data-placeholder="Search and select a subject...">
            <option value=""></option>
            <option ng-repeat="subject in vm.availableSubjects" 
                    value="{{ subject.intID }}">
              {{ subject.strCode }} - {{ subject.strDescription }}
            </option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Program (optional)</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.addCoreqProgram" placeholder="e.g. BSCS">
        </div>
        <div class="md:col-span-2 flex items-end">
          <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" ng-click="vm.addCoreq()" ng-disabled="vm.coreqsLoading || !vm.addCoreqId">Add Corequisite</button>
        </div>
      </div>

      <div class="overflow-x-auto border rounded">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              <th class="px-4 py-3 w-24">Row ID</th>
              <th class="px-4 py-3 w-32">Coreq ID</th>
              <th class="px-4 py-3">Code</th>
              <th class="px-4 py-3">Description</th>
              <th class="px-4 py-3 w-32">Program</th>
              <th class="px-4 py-3 w-32">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-100">
            <tr ng-if="!vm.coreqsLoading &amp;&amp; (!vm.coreqs || !vm.coreqs.length)">
              <td colspan="6" class="px-4 py-4 text-sm text-gray-500">
                No corequisites found.
              </td>
            </tr>
            <tr ng-repeat="p in vm.coreqs track by p.id">
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.id }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.intCorequisiteID }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.code || '-' }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.description || '-' }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.program || '-' }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">
                <button class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700" ng-click="vm.removeCoreq(p)">Remove</button>
              </td>
            </tr>
            <tr ng-if="vm.coreqsLoading">
              <td colspan="6" class="px-4 py-4 text-sm text-gray-500">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="mt-6 bg-white border rounded p-4">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-medium text-gray-800">Prerequisites</h2>
      <span class="text-xs text-gray-500" ng-if="!vm.isEdit">Save the subject first to manage prerequisites.</span>
    </div>

    <div ng-if="vm.isEdit">
      <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-4">
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Prerequisite Subject</label>
          <select class="w-full border rounded px-3 py-2" 
                  ng-model="vm.addPrereqId" 
                  select2
                  select2-watch="vm.availableSubjects"
                  data-placeholder="Search and select a subject...">
            <option value=""></option>
            <option ng-repeat="subject in vm.availableSubjects" 
                    value="{{ subject.intID }}">
              {{ subject.strCode }} - {{ subject.strDescription }}
            </option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-1">Program (optional)</label>
          <input type="text" class="w-full border rounded px-3 py-2" ng-model="vm.addPrereqProgram" placeholder="e.g. BSCS">
        </div>
        <div class="md:col-span-2 flex items-end">
          <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" ng-click="vm.addPrereq()" ng-disabled="vm.prereqsLoading || !vm.addPrereqId">Add Prerequisite</button>
        </div>
      </div>

      <div class="overflow-x-auto border rounded">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              <th class="px-4 py-3 w-24">Row ID</th>
              <th class="px-4 py-3 w-32">Prereq ID</th>
              <th class="px-4 py-3">Code</th>
              <th class="px-4 py-3">Description</th>
              <th class="px-4 py-3 w-32">Program</th>
              <th class="px-4 py-3 w-32">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-100">
            <tr ng-if="!vm.prereqsLoading &amp;&amp; (!vm.prereqs || !vm.prereqs.length)">
              <td colspan="6" class="px-4 py-4 text-sm text-gray-500">
                No prerequisites found.
              </td>
            </tr>
            <tr ng-repeat="p in vm.prereqs track by p.id">
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.id }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.intPrerequisiteID }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.code || '-' }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.description || '-' }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">{{ p.program || '-' }}</td>
              <td class="px-4 py-3 text-sm text-gray-900">
                <button class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700" ng-click="vm.removePrereq(p)">Remove</button>
              </td>
            </tr>
            <tr ng-if="vm.prereqsLoading">
              <td colspan="6" class="px-4 py-4 text-sm text-gray-500">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
