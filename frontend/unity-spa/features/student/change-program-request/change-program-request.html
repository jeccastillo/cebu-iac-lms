<div class="max-w-3xl mx-auto">
  <h1 class="text-2xl font-semibold text-gray-900 mb-6">Request Program Change</h1>

  <!-- Info alert -->
  <div class="bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded mb-4">
    Use this form to request a change to your academic Program. A Registrar will review your request. Only one request per term is allowed.
  </div>

  <!-- Errors -->
  <div ng-if="vm.error.init" class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4">
    {{ vm.error.init }}
  </div>
  <div ng-if="vm.error.programs" class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4">
    {{ vm.error.programs }}
  </div>
  <div ng-if="vm.error.submit" class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded mb-4">
    {{ vm.error.submit }}
  </div>

  <!-- Context -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="bg-white border rounded p-4">
      <div class="text-sm text-gray-500">Selected Term</div>
      <div class="text-base text-gray-900 font-medium" ng-if="vm.term">
        {{ vm.term.label || ('Term ID: ' + vm.term.id) }}
      </div>
      <div class="text-gray-500" ng-if="!vm.term">Resolving term...</div>
    </div>
    <div class="bg-white border rounded p-4">
      <div class="text-sm text-gray-500">Student</div>
      <div class="text-base text-gray-900 font-medium" ng-if="vm.profile">
        {{ (vm.profile.last_name || '') + (vm.profile.first_name ? ', ' + vm.profile.first_name : '') }}
        <span class="text-gray-500 ml-2" ng-if="vm.profile.student_number">({{ vm.profile.student_number }})</span>
      </div>
      <div class="text-xs text-gray-500 mt-1" ng-if="vm.studentLevelNormalized">
        Level: {{ (vm.studentLevelNormalized | uppercase) }}
      </div>
      <div class="text-gray-500" ng-if="!vm.profile">Resolving profile...</div>
    </div>
    <div class="bg-white border rounded p-4">
      <div class="text-sm text-gray-500">Current Program</div>
      <div class="text-base text-gray-900 font-medium" ng-if="vm.currentProgramCode || vm.currentProgramName">
        {{ vm.currentProgramLabel() }}
      </div>
      <div class="text-gray-500" ng-if="!vm.currentProgramCode && !vm.currentProgramName">
        <span ng-if="!vm.programInfoResolved">Resolving current program...</span>
        <span ng-if="vm.programInfoResolved">Unknown</span>
      </div>
      <div class="text-xs text-gray-500 mt-1" ng-if="vm.currentProgramCode || vm.currentProgramName">
        This program is excluded from the options.
      </div>
    </div>
  </div>

  <!-- Form -->
  <form class="bg-white border rounded p-6" ng-class="{ 'opacity-60 pointer-events-none': vm.submitted }" novalidate>
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-1">Target Program <span class="text-red-500">*</span></label>
      <select class="block w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200"
              ng-model="vm.form.program_to"
              ng-disabled="vm.loading.programs || vm.submitted"
              ng-options="p.id as vm.programLabel(p) for p in vm.programs">
        <option value="">-- Select a Program --</option>
      </select>
      <div class="text-xs text-gray-500 mt-1" ng-if="vm.loading.programs">Loading programs...</div>
    </div>

    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-1">Reason (optional)</label>
      <textarea class="block w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-200"
                rows="4"
                placeholder="You may provide a brief reason for your request (optional)."
                ng-model="vm.form.reason"
                ng-disabled="vm.submitted"></textarea>
    </div>

    <div class="flex items-center gap-3">
      <button type="button"
              class="inline-flex items-center px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50"
              ng-disabled="!vm.canSubmit() || vm.loading.submit"
              ng-click="vm.onSubmit()">
        <span ng-if="!vm.loading.submit">Submit Request</span>
        <span ng-if="vm.loading.submit">Submittingâ€¦</span>
      </button>
      <span class="text-sm text-gray-600" ng-if="vm.submitted">Your request has been submitted.</span>
    </div>
  </form>
</div>
