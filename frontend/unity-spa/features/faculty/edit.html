<div class="max-w-4xl mx-auto p-4">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-semibold">{{ vm.title }}</h1>
    <div>
      <button class="bg-gray-200 text-gray-800 px-3 py-2 rounded text-sm mr-2" ng-click="vm.cancel()" ng-disabled="vm.loading">Cancel</button>
      <button class="bg-blue-600 text-white px-3 py-2 rounded text-sm" ng-click="vm.save()" ng-disabled="vm.loading">
        <span ng-if="!vm.loading">Save</span>
        <span ng-if="vm.loading">Saving...</span>
      </button>
    </div>
  </div>

  <div class="mb-3" ng-if="vm.error">
    <div class="bg-red-50 text-red-700 border border-red-200 rounded px-3 py-2 text-sm">
      {{ vm.error }}
    </div>
  </div>
  <div class="mb-3" ng-if="vm.success">
    <div class="bg-green-50 text-green-700 border border-green-200 rounded px-3 py-2 text-sm">
      {{ vm.success }}
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Left column -->
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Username <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strUsername" placeholder="username" required>
      </div>

      <div ng-if="!vm.isEdit">
        <label class="block text-sm font-medium text-gray-700">Password <span class="text-red-600">*</span></label>
        <input type="password" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strPass" placeholder="password" required>
        <p class="text-xs text-gray-500 mt-1">Minimum 8 characters</p>
      </div>
      <div ng-if="vm.isEdit">
        <label class="block text-sm font-medium text-gray-700">Password (leave blank to keep unchanged)</label>
        <input type="password" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strPass" placeholder="new password (optional)">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">First Name <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strFirstname" required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Middle Name</label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strMiddlename" placeholder="optional">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Last Name <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strLastname" required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Email <span class="text-red-600">*</span></label>
        <input type="email" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strEmail" placeholder="name@example.com" required>
      </div>
    </div>

    <!-- Right column -->
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Mobile Number <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strMobileNumber" placeholder="0000000000" required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Address <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strAddress" required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Department <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strDepartment" required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">School <span class="text-red-600">*</span></label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strSchool" required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">User Level <span class="text-red-600">*</span></label>
        <input type="number" min="0" max="10" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.intUserLevel" required>
        <p class="text-xs text-gray-500 mt-1">Legacy values commonly 0, 2, or 7</p>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Teaching</label>
          <select class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.teaching">
            <option value="1">Yes</option>
            <option value="0">No</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Active</label>
          <select class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.isActive">
            <option value="1">Yes</option>
            <option value="0">No</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Faculty Number</label>
        <input type="text" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.strFacultyNumber" placeholder="optional unique code">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Campus</label>
        <input type="number" class="mt-1 block w-full border rounded px-3 py-2 text-sm" ng-model="vm.model.campus_id" placeholder="optional campus id">
      </div>
    </div>
  </div>

  <!-- Department Tags Panel (Edit mode only) -->
  <div class="mt-8" ng-if="vm.isEdit">
    <div class="bg-white rounded-lg shadow border border-gray-200">
      <div class="p-4 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Department Tags</h2>
        <p class="text-xs text-gray-500">Assign departments this faculty can act for. Campus is taken from the global campus selector.</p>
      </div>
      <div class="p-4 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="md:col-span-1">
            <label class="block text-sm font-medium text-gray-700">Department</label>
            <select class="mt-1 block w-full border rounded px-3 py-2 text-sm"
                    ng-model="vm.dept.form.department_code"
                    ng-options="d for d in vm.dept.meta.departments">
              <option value="">-- Select Department --</option>
            </select>
          </div>
          <div class="md:col-span-1">
            <label class="block text-sm font-medium text-gray-700">Campus (from global selector)</label>
            <div class="mt-1 block w-full border rounded px-3 py-2 text-sm bg-gray-50 text-gray-700">
              <span ng-if="vm.dept.selectedCampus">
                {{ vm.dept.selectedCampus.campus_name || 'Campus' }} (ID: {{ vm.dept.selectedCampus.id }})
              </span>
              <span ng-if="!vm.dept.selectedCampus" class="text-gray-500">
                No campus selected
              </span>
            </div>
            <p class="text-xs text-gray-500 mt-1">Change campus using the global selector in the header.</p>
          </div>
          <div class="md:col-span-1 flex items-end">
            <button type="button"
                    class="px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
                    ng-click="vm.addDepartmentTag()"
                    ng-disabled="vm.dept.loading || !vm.dept.form.department_code || !vm.dept.selectedCampus">
              <span ng-if="!vm.dept.loading">Add Tag</span>
              <span ng-if="vm.dept.loading">Saving...</span>
            </button>
          </div>
        </div>

        <div ng-if="vm.dept.error" class="bg-red-50 text-red-700 border border-red-200 rounded px-3 py-2 text-sm">
          {{ vm.dept.error }}
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Department</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Campus</th>
                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-100">
              <tr ng-repeat="t in vm.dept.list">
                <td class="px-3 py-2 text-sm text-gray-900">{{ t.department_code || t.department }}</td>
                <td class="px-3 py-2 text-sm text-gray-900">{{ (t.campus_id != null && t.campus_id !== '') ? t.campus_id : 'â€”' }}</td>
                <td class="px-3 py-2 text-right">
                  <button type="button"
                          class="text-xs px-2 py-1 rounded border border-red-300 text-red-700 hover:bg-red-50"
                          ng-click="vm.removeDepartmentTag(t)"
                          ng-disabled="vm.dept.loading">
                    Remove
                  </button>
                </td>
              </tr>
              <tr ng-if="!vm.dept.list.length">
                <td colspan="3" class="px-3 py-6 text-center text-sm text-gray-400">No department tags yet</td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</div>
